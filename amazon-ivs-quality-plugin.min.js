/*! For license information please see amazon-ivs-quality-plugin.min.js.LICENSE.txt */
var registerIVSQualityPlugin;
!(function () {
    "use strict";
    var e = {
            d: function (t, a) {
                for (var i in a) e.o(a, i) && !e.o(t, i) && Object.defineProperty(t, i, { enumerable: !0, get: a[i] });
            },
            o: function (e, t) {
                return Object.prototype.hasOwnProperty.call(e, t);
            },
        },
        t = {};
    !(function () {
        var a, i;
        e.d(t, {
            registerIVSQualityPlugin: function () {
                return n;
            },
        }),
            (function (e) {
                (e.INITIALIZED = "PlayerInitialized"),
                    (e.QUALITY_CHANGED = "PlayerQualityChanged"),
                    (e.DURATION_CHANGED = "PlayerDurationChanged"),
                    (e.VOLUME_CHANGED = "PlayerVolumeChanged"),
                    (e.MUTED_CHANGED = "PlayerMutedChanged"),
                    (e.PLAYBACK_RATE_CHANGED = "PlayerPlaybackRateChanged"),
                    (e.REBUFFERING = "PlayerRebuffering"),
                    (e.AUDIO_BLOCKED = "PlayerAudioBlocked"),
                    (e.PLAYBACK_BLOCKED = "PlayerPlaybackBlocked"),
                    (e.ERROR = "PlayerError"),
                    (e.RECOVERABLE_ERROR = "PlayerRecoverableError"),
                    (e.ANALYTICS_EVENT = "PlayerAnalyticsEvent"),
                    (e.TIME_UPDATE = "PlayerTimeUpdate"),
                    (e.BUFFER_UPDATE = "PlayerBufferUpdate"),
                    (e.SEEK_COMPLETED = "PlayerSeekCompleted"),
                    (e.SESSION_DATA = "PlayerSessionData"),
                    (e.STATE_CHANGED = "PlayerStateChanged"),
                    (e.WORKER_ERROR = "PlayerWorkerError"),
                    (e.METADATA = "PlayerMetadata"),
                    (e.TEXT_CUE = "PlayerTextCue"),
                    (e.TEXT_METADATA_CUE = "PlayerTextMetadataCue"),
                    (e.AD_CUE = "PlayerAdCue"),
                    (e.STREAM_SOURCE_CUE = "PlayerStreamSourceCue"),
                    (e.NETWORK_UNAVAILABLE = "PlayerNetworkUnavailable"),
                    (e.SEGMENT_DISCONTINUITY = "PlayerSegmentDiscontinuity"),
                    (e.SEGMENT_METADATA = "PlayerSegmentMetadata");
            })(a || (a = {})),
            (function (e) {
                (e.IDLE = "Idle"), (e.READY = "Ready"), (e.BUFFERING = "Buffering"), (e.PLAYING = "Playing"), (e.ENDED = "Ended");
            })(i || (i = {}));
        var l = "enableIVSQualityPlugin";
        function n(e) {
            if (void 0 === e || "function" != typeof e.getTech) throw { message: "videojs not available, Amazon IVS Quality Plugin not registered", code: 1 };
            if (!e.getPlugin(l)) {
                var t = e.getComponent("MenuButton"),
                    n = e.getComponent("MenuItem"),
                    r = e.extend(n, {
                        constructor: function (e, t) {
                            var a = t.quality;
                            n.call(this, e, { selectable: !0, label: a.name }), (this.quality = a);
                        },
                        handleClick: function (e) {
                            n.prototype.handleClick.call(this, e);
                            var t = this.player().getIVSPlayer();
                            "auto" === this.quality.group ? t.setAutoQualityMode(!0) : t.setQuality(this.quality);
                        },
                    }),
                    o = e.extend(t, {
                        constructor: function (e) {
                            t.call(this, e, {}), this.controlText("Quality");
                        },
                        createItems: function () {
                            var e = this.player(),
                                t = e.getIVSPlayer(),
                                i = [],
                                l = new r(e, { quality: { group: "auto", name: "Auto" } });
                            l.selected(t.isAutoQualityMode()), l.on("click", this._clickHandler.bind(this, l)), l.on("tap", this._clickHandler.bind(this, l)), i.push(l);
                            var n = t.getQuality(),
                                o = t.getQualities();
								 var qualityname = localStorage.getItem('videoQuality');

if (qualityname) {
    var storedQuality = t.getQualities().find(quality => quality.name === qualityname);
	 t.setQuality(storedQuality,false);	
}							 

								t.addEventListener('PlayerQualityChanged', function(event) {
	var o=t.getQuality();
	console.log("new quality :",o);
	localStorage.setItem('videoQuality', o.name);
});	
                            return (
                                o &&
                                    o.length > 0 &&
                                    o.forEach(
                                        function (a) {
                                            var l = new r(e, { quality: a });
                                            l.on("click", this._clickHandler.bind(this, l)), l.on("tap", this._clickHandler.bind(this, l)), t.isAutoQualityMode() || l.selected(n.group === a.group), i.push(l);
                                        }.bind(this)
                                    ),
                                t.addEventListener(a.QUALITY_CHANGED, function (a) {
                                    e.controlBar.getChild("QualityMenuButton").qualityItems.forEach(function (e) {
                                        !t.isAutoQualityMode() && a && e && e.quality && e.selected(a.group === e.quality.group);
                                    });
                                }),
                                (this.qualityItems = i),
                                i
                            );
                        },
                        buildCSSClass: function () {
                            return "vjs-icon-hd vjs-icon-placeholder " + t.prototype.buildCSSClass.call(this);
                        },
                        _clickHandler: function (e) {
                            this.items.forEach(function (t) {
                                t !== e && t.selected(!1);
                            });
                        },
                    });
                e.registerComponent("QualityMenuButton", o),
                    (e.registerPlugin || e.plugin)(l, function () {
                        var e = this;
                        e.getIVSPlayer().addEventListener(i.READY, function () {
                            var t = e.controlBar.getChild("QualityMenuButton");
                            t && (t.dispose(), e.controlBar.removeChild(t)), e.controlBar.addChild("QualityMenuButton");
                        });
                    });
            }
        }
    })(),
        (registerIVSQualityPlugin = t.registerIVSQualityPlugin);
})();
